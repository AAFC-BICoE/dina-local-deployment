# Default values for dina-helm-test.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1
app:
  name: dina-helm-test

global:
  environment:
    keycloak:
      enabled: "true"
      auth_server_url: http://keycloak-service:8080/auth
    elasticsearch:
      host: elasticsearch-dina-service
      port: 9200
services:
  minio:
    image: minio/minio:RELEASE.2022-10-05T14-58-27Z
    environment:
      MINIO_ACCESS_KEY: minio
      MINIO_SECRET_KEY: minio123
  elasticsearch_dina:
    image: elasticsearch_icu:7.17.10
    environment:
      xpack:
        security:
          enabled: "false"
      discovery:
        type: single-node
      action:
        auto_create_index: "false"
    ulimits:
      memlock:
        soft: -1
        hard: -1
      nofile:
        soft: 65536
        hard: 65536
    cap_add:
      - IPC_LOCK
  dinadb:
    #image: "postgis/postgis:12-3.1-alpine"
    image: "postgres:12"
    pullPolicy: IfNotPresent
    #healthcheck:
      #test: [ "CMD", "pg_isready", "-q", "-d", "${POSTGRES_DB}", "-U", "${POSTGRES_USER}" ]
      #timeout: 5s
      #interval: 10s
      #retries: 10
    environment:
      POSTGRES_DB: dina
      POSTGRES_PASSWORD: pg1234
      POSTGRES_USER: pguser
    port: 5432
  initdb:
    image: aafcbicoe/dina-db-init-container:0.3
    pullPolicy: IfNotPresent
    environment:
      POSTGRES_HOST: keycloak-db-service
      POSTGRES_DB: dina
      POSTGRES_PASSWORD: pg1234
      POSTGRES_USER: pguser
      DINA_DB: agent collection dina_user object_store seqdb loan_transaction export
      MIGRATION_USER_agent: migration_user_agent
      MIGRATION_USER_PW_agent: muagent123
      WEB_USER_agent: web_user_agent
      WEB_USER_PW_agent: wuagent321
      MIGRATION_USER_collection: migration_user_coll
      MIGRATION_USER_PW_collection: mucoll123
      WEB_USER_collection: web_user_coll
      WEB_USER_PW_collection: wucoll321
      PG_EXTENSION_collection: postgis
      MIGRATION_USER_dina_user: migration_user_dina_user
      MIGRATION_USER_PW_dina_user: muuser123
      WEB_USER_dina_user: web_user_dina_user
      WEB_USER_PW_dina_user: wuuser321
      MIGRATION_USER_object_store: migration_user_os
      MIGRATION_USER_PW_object_store: muos123
      WEB_USER_object_store: web_user_os
      WEB_USER_PW_object_store: wuos321
      MIGRATION_USER_seqdb: migration_user_seqdb
      MIGRATION_USER_PW_seqdb: museqdb123
      WEB_USER_seqdb: web_user_seqdb
      WEB_USER_PW_seqdb: wuseqdb321
      PG_EXTENSION_seqdb: pgcrypto
      MIGRATION_USER_loan_transaction: migration_user_lt
      MIGRATION_USER_PW_loan_transaction: mult123
      WEB_USER_loan_transaction: web_user_lt
      WEB_USER_PW_loan_transaction: wult123
      MIGRATION_USER_export: migration_user_ex
      MIGRATION_USER_PW_export: muex123
      WEB_USER_export: web_user_ex
      WEB_USER_PW_export: wuex321
  seqdbapi:
    image: aafcbicoe/seqdb-api:2.10.0
    environment:
      spring:
        datasource:
          url: jdbc:postgresql://keycloak-db-service/seqdb?currentSchema=seqdb
          username: web_user_seqdb
          password: wuseqdb321
        liquibase:
          user: migration_user_seqdb
          password: museqdb123keycloak-db-service
  dinaui:
    image: aafcbicoe/dina-ui:0.135.0
    environment:
      KEYCLOAK_CLIENTID: dina-public
      KEYCLOAK_REALM: dina
      KEYCLOAK_PUBLIC_URL: https://dina.local/auth
      OBJECTSTORE_API_ADDRESS: object-store-api:8080
      AGENT_API_ADDRESS: agent-api:8080
      SEQDB_API_ADDRESS: seqdb-api:8080
      COLLECTION_API_ADDRESS: collection-api:8080
      USER_API_ADDRESS: dina-user-api:8080
      SEARCH_API_ADDRESS: search-ws:8085
      LOAN_TRANSACTION_API_ADDRESS: loan-transaction-api:8080
      REPORT_LABEL_API_ADDRESS: dina-export-api:8080
      INSTANCE_MODE: developer
  agentapi:
    image: aafcbicoe/agent-api:0.25
    environment:
      spring:
        datasource:
          url: jdbc:postgresql://keycloak-db-service/agent?currentSchema=agent
          username: web_user_agent
          password: wuagent321
        liquibase:
          user: migration_user_agent
          password: muagent123
  objectstoreapi:
    image:
    environment:
      spring:
        datasource:
          url: jdbc:postgresql://keycloak-db-service/object_store?currentSchema=object_store
          username: web_user_os
          password: wuos321
        servlet:
          multipart:
            max_file_size: 1GB
            max_request_size: 1GB
        liquibase:
          user: migration_user_os
          password: muos123
      minio: 
        host: minio
        accessKey: minio
        secretKey: minio123
  dinaexportapi:
    image: aafcbicoe/dina-export-api:0.3
    environment:
      spring:
        datasource:
          url: jdbc:postgresql://keycloak-db-service/export?currentSchema=export
          username: web_user_ex
          password: wuex321
        liquibase:
          user: migration_user_exe
          password: muex123
          liquibase_schema: export
        freemarker:
          template_loader_path: classpath:/templates/,file:/tmp/dina-data-export/templates/
      dina:
        export:
          workingFolder: /tmp/dina-data-export
      elasticsearch:
        host:
        port:
  dinauserapi:
    image: aafcbicoe/dina-user-api:0.15
    environment:
      spring:
        datasource:
          url: jdbc:postgresql://keycloak-db-service/dina_user?currentSchema=dina_user
          username: web_user_dina_user
          password: wuuser321
        liquibase:
          user: migration_user_dina_user
          password: muuser123
  loantransactionapi:
    image:
    environment:
      spring:
        datasource:
          url: jdbc:postgresql://keycloak-db-service/loan_transaction?currentSchema=loan_transaction
          username: web_user_lt
          password: wult321
        liquibase:
          user: migration_user_lt
          password: mult123
          contexts: schema-change initial-data data-migration
  collectionapi:
    image: aafcbicoe/natural-history-collection-api:0.79
    environment:
      spring:
        datasource:
          url: jdbc:postgresql://keycloak-db-service/collection?currentSchema=collection
          username: web_user_coll
          password: wucoll321
        liquibase:
          user: migration_user_coll
          password: mucoll123
      actuator:
        allowedIP: prometheus
  keycloak:
    pullPolicy: IfNotPresent
    image: "quay.io/keycloak/keycloak:20.0.5"
    environment:
      KC_DB_PASSWORD: keycloak_user
      KEYCLOAK_ADMIN: admin
      KEYCLOAK_ADMIN_PASSWORD: admin
      KC_DB_URL_HOST: keycloak-db-service
      KC_DB_URL_DATABASE: keycloak_db
      KC_DB_USERNAME: keycloak_user
      KC_HOSTNAME: dina.local
      KC_HOSTNAME_ADMIN: keycloak.dina.local
      KC_PROXY: edge
  keycloakdb:
    image: "postgres:12"
    environment:
      POSTGRES_DB: keycloak_db
      POSTGRES_PASSWORD: keycloak_user
      POSTGRES_USER: keycloak_user
      DB_USER: kc_user
      DB_PASSWORD: kc_user
      USE_V2: "true"
image:
  repository: nginx
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Automatically mount a ServiceAccount's API credentials?
  automount: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

ingress:
  enabled: true
  tls: true
  className: ""
  annotations:
    #kubernetes.io/ingress.class: nginx
    #kubernetes.io/tls-acme: "true"
  hosts:
    - host: keycloak.dina.local/auth
      paths:
        - path: /
          pathType: Prefix
podAnnotations: {}
podLabels: {}

podSecurityContext: {}
  # fsGroup: 2000

securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

resources:
  limits:
    memory: 48Mi
    cpu: 20m
  # We usually recommend not to specify default resources and to leave this as a conscious
  # choice for the user. This also increases chances charts run on environments with little
  # resources, such as Minikube. If you do want to specify resources, uncomment the following
  # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  requests:
    cpu: 10m
    memory: 24Mi

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 100
  targetCPUUtilizationPercentage: 80
  # targetMemoryUtilizationPercentage: 80

# Additional volumes on the output Deployment definition.
volumes: []
# - name: foo
#   secret:
#     secretName: mysecret
#     optional: false

# Additional volumeMounts on the output Deployment definition.
volumeMounts: []
# - name: foo
#   mountPath: "/etc/foo"
#   readOnly: true

nodeSelector: {}

tolerations: []

affinity: {}
