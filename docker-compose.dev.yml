version: "3.9"

services:
  # Nextjs's dev-mode server that hot-reloads the UI source code:
  dina-ui-dev-server:
    image: node:14.18.1
    volumes:
      - "${DINA_UI_REPO_DIRECTORY}:/dina-ui"
    stop_signal: SIGKILL
    command: >
      bash -c "
      yarn --cwd=/dina-ui/packages/dina-ui ;
      yarn --cwd=/dina-ui/packages/dina-ui dev
      "
    networks:
      - dina
  
  # Front-end gateway that proxies URLs to the correct service. This overrides the dina-ui in docker-compose.
  dina-ui:
    volumes:
      - "${DINA_UI_REPO_DIRECTORY}/packages/dina-ui/dev.Caddyfile:/etc/caddy/Caddyfile"
    environment:
      UI_DEV_SERVER_ADDRESS: dina-ui-dev-server:3000