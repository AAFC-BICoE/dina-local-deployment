= Get Everything Running Locally
 
Once you have your development environment set up, you can run the DINA application locally.
 
The `dina-local-deployment` project contains a `start_stop_dina.sh` script that acts as a wrapper for Docker Compose. It allows you to select specific modules and configuration layers without typing out long docker compose commands manually.

== Configuration

To configure your local stack, open `start_stop_dina.sh` in your text editor. There are two sections that you can modify.

Each line can be commented or uncommented to include or exclude that specific module or configuration.

=== DINA Module Configuration

The `DINA_MODULES` section defines which containers you wish to run.

[cols="1,3", options="header"]
|===
|Profile Name |Description

|user_api
|Starts the User API service, which handles user authentication and management. This service is required for most other services to function.

|object_store_api
|Starts the Object Store API service, which handles file uploads, metadata, and storage (images, documents, etc.).

|agent_api
|Starts the Agent API service, which manages Agents (People and Organizations).

|search_api
|Starts the Search API and Elasticsearch related containers. Provides the search functionality, indexing data into Elasticsearch.

|seqdb_api
|Starts the SeqDB API service, which manages molecular and sequence database information.

|export_api
|Starts the Export API service, which handles data export requests and generation.

|loan_transaction_api
|Starts the Loan Transaction API service, which manages loans and transactions of specimens.

|kibana
|Starts the Kibana dashboard. useful for visualizing data in Elasticsearch.

|prometheus
|Starts Prometheus for scraping and monitoring metrics from the running services.
|===

Important: Enabling too many modules may lead to high resource consumption on your local machine. Only enable the modules you need for your current development work.

=== DINA Configs

The `DINA_CONFIGS` section defines which docker-compose configuration files to include when starting the stack. Each configuration file adds or overrides settings in the base configuration.

[cols="1,3", options="header"]
|===
|Config File |Purpose

|docker-compose.base.yml
|Required. Defines the core services, networks, and volumes. This is the foundation of the deployment.

|docker-compose.local.yml
|Required. Defines the core services, networks and volumes for a local development environment. This is where you can see each specific version of services used for local deployment.

|docker-compose.dev.yml
|Optional. Enables hot-reloading for the dina-ui service. Useful for frontend development.

|docker-compose.debug.yml
|Optional. Opens remote debugging ports on the Java containers. Enable this to attach a debugger from your IDE.

|message-producing-override
|Optional. Configures services to emit RabbitMQ messages upon data changes. Recommended for development purposes.

|persistence-override
|Optional. Configures databases to use persistent volumes on your host machine. Use this if you want your data to survive after running down.

|keycloak/docker-compose.enable-dev-user.yml
|Optional. Disables keycloak and automatically logs in a development user for easier testing without going through the login process.
|===

== Starting the Stack

To start the DINA application stack, run the following command from the root of the `dina-local-deployment` project:

[source,bash]
----
./start_stop_dina.sh up
----

This will start all the selected configuration and follow the logs in your terminal. To run the stack in detached mode (in the background), use:

[source,bash]
----
./start_stop_dina.sh up -d
----

== Accessing the Application

After all the components have finished initializing, the UI will be available at `http://dina.local/`. By default, the following users are included:

* `cnc-su`: `super-user` in the `cnc` group
* `cnc-user`: a `user` in the `cnc` group
* `cnc-guest`: a `guest` in the `cnc` group
* `cnc-ro`: a `read-only` user in the `cnc` group
* `dina-admin`: a `dina-admin` in the `aafc` group

The password is the same as the username for all users.

== Stopping the Stack

To stop the DINA application stack, run the following command:

[source,bash]
----
./start_stop_dina.sh stop
----
